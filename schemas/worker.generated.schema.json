{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "RobotFarmTurn",
  "description": "Structured agent turn payload.",
  "type": "object",
  "properties": {
    "blocked": {
      "description": "Blocked tasks payload when intent=BLOCKED.",
      "type": "array",
      "items": {
        "$ref": "#/$defs/BlockedEntry"
      }
    },
    "completed": {
      "description": "Completed tasks payload when intent=COMPLETE_TASKS.",
      "type": "array",
      "items": {
        "$ref": "#/$defs/WorkerCompletion"
      }
    },
    "details": {
      "description": "Expanded details supporting the summary.",
      "type": "string"
    },
    "intent": {
      "$ref": "#/$defs/WorkerIntent"
    },
    "summary": {
      "description": "One-line summary of the turn.",
      "type": "string"
    }
  },
  "additionalProperties": false,
  "required": [
    "intent",
    "summary",
    "details",
    "completed",
    "blocked"
  ],
  "$defs": {
    "BlockedEntry": {
      "description": "Blocked entry describing impediments.",
      "type": "object",
      "properties": {
        "proposed_unblock_steps": {
          "description": "Suggestions for unblocking the task.",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "reason": {
          "description": "Explanation of why work cannot proceed.",
          "type": "string"
        },
        "requires_merge_resolution": {
          "description": "Whether a merge conflict must be resolved.",
          "type": "boolean"
        },
        "task_slug": {
          "description": "Slug of the blocked task.",
          "type": "string"
        }
      },
      "additionalProperties": false,
      "required": [
        "task_slug",
        "reason",
        "requires_merge_resolution",
        "proposed_unblock_steps"
      ]
    },
    "WorkerCompletion": {
      "description": "Completion entry for a worker turn (no answer payload).",
      "type": "object",
      "properties": {
        "commit_summary": {
          "description": "Short summary describing the changes for auto-commit messages. Aim for <= 72 characters.",
          "type": "string",
          "maxLength": 120,
          "minLength": 3
        },
        "notes": {
          "description": "Completion notes or highlights.",
          "type": "string"
        },
        "open_questions": {
          "description": "Follow-up questions, if any.",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "task_slug": {
          "description": "Slug of the task that was completed.",
          "type": "string"
        }
      },
      "additionalProperties": false,
      "required": [
        "task_slug",
        "notes",
        "open_questions",
        "commit_summary"
      ]
    },
    "WorkerIntent": {
      "description": "Intent values for worker agents.",
      "type": "string",
      "enum": [
        "STATUS_UPDATE",
        "COMPLETE_TASK",
        "BLOCKED",
        "ACK_PAUSE"
      ]
    }
  }
}